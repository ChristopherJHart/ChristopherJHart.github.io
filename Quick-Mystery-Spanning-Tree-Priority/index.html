<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Quick Mystery - Spanning Tree Priority" /><meta property="og:locale" content="en" /><meta name="description" content="One aspect of Spanning Tree Protocol I became curious about during my CCIE studies was the exact behavior behind how Spanning Tree bridge priorities are modified using the spanning-tree vlan {vlan-id} root {primary | secondary} configuration command. This post explores this behavior in the lab!" /><meta property="og:description" content="One aspect of Spanning Tree Protocol I became curious about during my CCIE studies was the exact behavior behind how Spanning Tree bridge priorities are modified using the spanning-tree vlan {vlan-id} root {primary | secondary} configuration command. This post explores this behavior in the lab!" /><link rel="canonical" href="https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/" /><meta property="og:url" content="https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/" /><meta property="og:site_name" content="Christopher Hart" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-29T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Quick Mystery - Spanning Tree Priority" /><meta name="twitter:site" content="@_ChrisJHart" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"One aspect of Spanning Tree Protocol I became curious about during my CCIE studies was the exact behavior behind how Spanning Tree bridge priorities are modified using the spanning-tree vlan {vlan-id} root {primary | secondary} configuration command. This post explores this behavior in the lab!","url":"https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/","@type":"BlogPosting","headline":"Quick Mystery - Spanning Tree Priority","dateModified":"2019-11-29T00:00:00-05:00","datePublished":"2019-11-29T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/"},"@context":"https://schema.org"}</script><title>Quick Mystery - Spanning Tree Priority | Christopher Hart</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Christopher Hart"><meta name="application-name" content="Christopher Hart"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars3.githubusercontent.com/u/13562529" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Christopher Hart</a></div><div class="site-subtitle font-italic">Documenting my discoveries in the IT world</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ChristopherJHart" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_ChrisJHart" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['christopherjhart95','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Quick Mystery - Spanning Tree Priority</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Quick Mystery - Spanning Tree Priority</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Christopher Hart </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Nov 29, 2019, 12:00 AM -0500" >Nov 29, 2019<i class="unloaded">2019-11-29T00:00:00-05:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2296 words">12 min read</span></div></div><div class="post-content"><p>One aspect of Spanning Tree Protocol I became curious about during my CCIE studies was the exact behavior behind how Spanning Tree bridge priorities are modified using the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root {primary | secondary}</code> configuration command. This post explores this behavior in the lab!</p><h2 id="mystery">Mystery</h2><p>In this post, we seek to answer two questions:</p><ol><li><p>If a bridge is configured to automatically become the root of the Spanning Tree with the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code> configuration command, will it preempt itself as the root if another bridge’s priority suddenly becomes lower and challenges the root bridge?</p><li><p>What is the exact behavior behind the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root {primary | secondary}</code> configuration command?</p></ol><h2 id="topology">Topology</h2><p><img data-proofer-ignore data-src="/images/2019-11-QM-STP-Topology.png" alt="" /></p><p>Testing was performed through VIRL 1.6.0 using IOSvL2 nodes running IOS 15.2.</p><h2 id="testing">Testing</h2><p>First, let’s check the current Spanning Tree state in VLAN 1 on S1. By default, S1 is the root bridge because it holds the lowest bridge address in the L2 domain.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    32769
             Address     5e00.0000.0000
             This bridge is the root    &lt;&lt;&lt;
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  300 sec
</pre></table></code></div></div><p>S1 is configured to automatically become the root of the L2 domain in VLAN 1 through the <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root primary</code> configuration command.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>S1#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
S1(config)#spanning-tree vlan 1 root primary
S1(config)#end
</pre></table></code></div></div><p>Let’s review the configuration that is <em>actually</em> applied.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>S1#show run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 24576    &lt;&lt;&lt;
</pre></table></code></div></div><p>Let’s verify that the bridge priority of S1 has changed accordingly.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    24577    &lt;&lt;&lt;
             Address     5e00.0000.0000
             This bridge is the root
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    24577  (priority 24576 sys-id-ext 1)
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  300 sec
</pre></table></code></div></div><p>For future reference, note that the priority of 24,576 that was applied is 8192 less than the default bridge priority value of 32,768. Next, let’s configure S2 with a bridge priority of 16,384.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>S2#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
S2(config)#spanning-tree vlan 1 priority 16384
S2(config)#end
</pre></table></code></div></div><p>S2 confirms that it is now the root bridge.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>S2#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    16385    &lt;&lt;&lt;
             Address     5e00.0001.0000
             This bridge is the root    &lt;&lt;&lt;
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    16385  (priority 16384 sys-id-ext 1)
             Address     5e00.0001.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  15  sec
</pre></table></code></div></div><p>This suggests that S1 does not preempt itself as the root bridge when configured with <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code>. We can confirm this by checking the Spanning Tree state and configuration of S1.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    16385
             Address     5e00.0001.0000    &lt;&lt;&lt;
             Cost        4
             Port        2 (GigabitEthernet0/1)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    24577  (priority 24576 sys-id-ext 1)    &lt;&lt;&lt;
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  15  sec

S1#sh run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 24576    &lt;&lt;&lt;
</pre></table></code></div></div><p>The results of this test answer our first question. <strong>A switch configured with <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code> will not preempt the root bridge role if another bridge with a superior BPDU usurps the role</strong>. Instead, this configuration command is essentially a macro that causes the local switch to analyze the current root bridge’s ID, determine what bridge priority configuration needs to be applied to become the root bridge, and apply the resulting configuration. This macro only runs when the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code> command is executed, so it is not able to preempt the root bridge role.</p><p>Now, let’s try a second scenario. What happens if we configure <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root primary</code> once more on S1?</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>S1#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
S1(config)#spanning-tree vlan 1 root primary 
S1(config)#end
S1#show run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 16384
S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    16385
             Address     5e00.0000.0000
             This bridge is the root
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    16385  (priority 16384 sys-id-ext 1)
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  15  sec
</pre></table></code></div></div><p>S1 analyzed the current root bridge’s ID and found that it could become the root bridge if it lowered its priority to match that of the existing root bridge (S2) because its system MAC address (5e00.0000.0000) is lower than S2’s (5e00.0001.0000).</p><p>At first glance, this behavior seems contrary to what is stated in Cisco’s documentation. The <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750/software/release/15-0_2_se/configuration/guide/scg3750/swstp.html#23902">“Configuring STP” chapter of the Catalyst 3750 Switch Software Configuration Guide </a> for IOS 15.0(2)SE and Later states the following:</p><blockquote><p>“To configure a switch to become the root for the specified VLAN, use the <code class="language-plaintext highlighter-rouge">spanning-tree vlan vlan-id root</code> global configuration command to modify the switch priority from the default value (32768) to a significantly lower value. <strong>When you enter this command, the software checks the switch priority of the root switches for each VLAN.</strong> Because of the extended system ID support, <strong>the switch sets its own priority for the specified VLAN to 24576 if this value will cause this switch to become the root for the specified VLAN.</strong></p></blockquote><blockquote><p>If any root switch for the specified VLAN has a switch priority lower than 24576, the switch sets its own priority for the specified VLAN to 4096 less than the lowest switch priority.”</p></blockquote><p>The first paragraph describes the behavior we initially observed when we configured <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root primary</code> on S1 for the first time. In that scenario, the bridge priority of all bridges was set to 32,768, so S1 set its bridge priority to 24,576 as described by the documentation.</p><p>However, the second paragraph describes behavior that S1 did not abide by in the second scenario. In the second scenario, the existing root bridge’s priority was 16,384. According to the documentation, S1 <em>should</em> have set its bridge priority to 12,288. Instead, <strong>S1 knew that its system MAC address was low enough to become the root bridge if it matched S2’s bridge priority, so it modified its configuration accordingly.</strong></p><p>Let’s try a third scenario involving S4, which has a system MAC address of 5e00.0003.0000. In this scenario, all bridges started with a bridge priority of 32,768. S1 was configured with <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root primary</code>, applying a configuration of <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 priority 24576</code> to the device.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>S1#show run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 24576    &lt;&lt;&lt;
S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    24577    &lt;&lt;&lt;
             Address     5e00.0000.0000
             This bridge is the root    &lt;&lt;&lt;
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    24577  (priority 24576 sys-id-ext 1)
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  15  sec
</pre></table></code></div></div><p>S4 agrees that S1 is currently the root bridge.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>S4#sh spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    24577    &lt;&lt;&lt;
             Address     5e00.0000.0000    &lt;&lt;&lt;
             Cost        4
             Port        6 (GigabitEthernet1/1)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     5e00.0003.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  15  sec
</pre></table></code></div></div><p>Let’s configure S4 with the <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root primary</code> configuration command and see what configuration is applied.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>S4#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
S4(config)#spanning-tree vlan 1 root primary 
S4(config)#end
S4#sh run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 20480
</pre></table></code></div></div><p>Finally, let’s confirm that S4 now views itself as the root bridge.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>S4#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    20481
             Address     5e00.0003.0000
             This bridge is the root
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    20481  (priority 20480 sys-id-ext 1)
             Address     5e00.0003.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  300 sec
</pre></table></code></div></div><p>Here, S4 recognized that if it matched S1’s bridge priority of 24,576, it would still lose the root bridge election because S1’s system MAC address is lower (and, therefore, superior) to S4’s own system MAC address. In order to honor the administrator’s intent of making S4 the root bridge, <strong>S4 lowered its own bridge priority by 4096 to 20,480 as described by the documentation mentioned above.</strong></p><p>Finally, let’s give S3 some attention by configuring it as a secondary root bridge with the <code class="language-plaintext highlighter-rouge">spanning-tree vlan 1 root secondary</code> configuration command. First, let’s verify S3’s current perspective on the VLAN 1 spanning tree.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>S3#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
   Spanning tree enabled protocol ieee
   Root ID    Priority    20481
              Address     5e00.0003.0000
              Cost        4              
              Port        2 (GigabitEthernet0/1)              
              Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec   


   Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
              Address     5e00.0002.0000
              Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
              Aging Time  300 sec
</pre></table></code></div></div><p>Recall that while there can only be a single root bridge in an L2 domain, the administrator can configure multiple bridges as “secondaries” to act as backup root bridges. Bridges configured with the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root secondary</code> configuration command will be <em>more likely</em> (but <strong>not</strong> guaranteed, as our scenario will show) to become the root bridge in the event that the primary root bridge fails.</p><p>Let’s configure S3 with the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root secondary</code> command and see what configuration is applied.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>S3#configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
S3(config)#spanning-tree vlan 1 root secondary
S3(config)#end
S3#show run | i spa
spanning-tree mode pvst
spanning-tree extend system-id
spanning-tree vlan 1 priority 28672    &lt;&lt;&lt;
</pre></table></code></div></div><p>As you can see, S3 modified its configuration such that its bridge priority is 28,672. This behavior is documented in the <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst3750/software/release/15-0_2_se/configuration/guide/scg3750/swstp.html#21421">“Configuring STP” chapter of the Catalyst 3750 Switch Software Configuration Guide for IOS 15.0(2)SE and Later</a>:</p><blockquote><p>“<strong>When you configure a switch as the secondary root, the switch priority is modified from the default value (32768) to 28672</strong>. The switch is then likely to become the root switch for the specified VLAN if the primary root switch fails. This is assuming that the other network switches use the default switch priority of 32768 and therefore are unlikely to become the root switch.”</p></blockquote><p>However, in the event that the root bridge (S4) fails, S3 will not become the root bridge, because S1 still has a lower priority.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>S1#show spanning-tree vlan 1
&lt;snip&gt;
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    20481
             Address     5e00.0003.0000
             Cost        4
             Port        6 (GigabitEthernet1/1)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec


  Bridge ID  Priority    24577  (priority 24576 sys-id-ext 1)    &lt;&lt;&lt;
             Address     5e00.0000.0000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  300 sec
</pre></table></code></div></div><p>As mentioned before, the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root secondary</code> command simply makes a bridge <em>more likely</em> to become the root bridge in the event that the primary root bridge fails. However, it does not guarantee what specific place in the hierarchy the bridge holds.</p><h2 id="results">Results</h2><p>In conclusion, we’ve demonstrated three things:</p><ol><li><p>A bridge configured as the primary root bridge through the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code> configuration command will not preempt the root bridge role if a bridge with a superior BPDU comes online and usurps the role.</p><li><p>The <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root primary</code> configuration command can guarantee that the local bridge will become the root bridge <em>at the instantaneous moment that command is executed</em>. However, because it lacks any preempt behavior, there is no guarantee that the local bridge will <em>remain</em> the root bridge in the future.</p><li><p>The <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} root secondary</code> configuration command is only truly helpful if all other bridges (aside from the root bridge) are configured with a default bridge priority of 32,768. Otherwise, it may be best to manually configure a hierarchy of bridge priorities using the <code class="language-plaintext highlighter-rouge">spanning-tree vlan {vlan-id} priority {priority-value}</code> configuration command on your desired primary and secondary root bridges.</p></ol><p>I hope that you find this helpful!</p></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Quick Mystery - Spanning Tree Priority - Christopher Hart&url=https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Quick Mystery - Spanning Tree Priority - Christopher Hart&u=https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Quick Mystery - Spanning Tree Priority - Christopher Hart&url=https://www.chrisjhart.com/Quick-Mystery-Spanning-Tree-Priority/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/Windows-10-ssh-copy-id/">Windows 10 OpenSSH Equivalent of ssh-copy-id</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/How-Data-Plane-Traffic-Can-Become-Control-Plane-Traffic/"><div class="card-body"> <span class="timeago small" >Nov 21<i class="unloaded">2021-11-21T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ICMP Redirects - How Data Plane Traffic Can Become Control Plane Traffic</h3><div class="text-muted small"><p> Note: If you are not familiar with the concepts of the data plane and control plane on network devices, I highly recommend reviewing my Understanding the Data, Control, and Management Planes of ...</p></div></div></a></div><div class="card"> <a href="/Understanding-Control-Plane-Packet-Loss-due-to-CoPP/"><div class="card-body"> <span class="timeago small" >Nov 13<i class="unloaded">2021-11-13T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Understanding Control Plane Packet Loss due to CoPP</h3><div class="text-muted small"><p> Note: If you are not familiar with the concepts of the data plane and control plane on network devices, I highly recommend reviewing my Understanding the Data, Control, and Management Planes of ...</p></div></div></a></div><div class="card"> <a href="/Understanding-Data-Control-Management-Planes/"><div class="card-body"> <span class="timeago small" >Nov 12<i class="unloaded">2021-11-12T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Understanding the Data, Control, and Management Planes of Network Devices</h3><div class="text-muted small"><p> While troubleshooting connectivity issues and packet loss in computer networks, network engineers often misunderstand the difference between the data plane and control plane. This can lead to fault...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/Bridging-The-Gap-Frame-Relay/" class="btn btn-outline-primary" prompt="Older"><p>Bringing The Gap - Frame Relay</p></a> <a href="/Deep-Dive-Spanning-Tree-Topology-Change/" class="btn btn-outline-primary" prompt="Newer"><p>Deep Dive - IEEE 802.1D Spanning Tree Topology Change</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/_ChrisJHart">Christopher Hart</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script>
